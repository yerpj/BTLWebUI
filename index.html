<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/></meta>
		<link rel="stylesheet" type="text/css" href="styles.css">
		

		<DP>debug version: 0.1.6</DP>
		<div align= "center">
			<HP>LaVue live</HP>
			<div id="LiveGraphElem" style="width:800px;height:300px" ></div><br>
			<DP>debug box:</DP><br>
			<textarea id="StatusBox" rows="10" cols="50">StatusBox</textarea>
		</div>
		
		<!--[if lte IE 8]><script type="text/javascript" language="javascript" src="excanvas.min.js"></script><![endif]-->
		<!--<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>-->
		<script src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
		<script src="http://cdn.jsdelivr.net/jquery.flot/0.8.3/jquery.flot.min.js"></script><!--http://code.jquery.com/jquery-1.10.1.min.js-->
		
		<script src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
		    var Xaxis=[[0,0]];
		    var Yaxis=[[0,0]];
		    var Zaxis=[[0,0]];
			var dataset = [{ label: "X axis", data: Xaxis, color: "#3d7504"},{ label: "Y axis", data: Yaxis, color: "#2e47af"},{ label: "Z axis", data: Zaxis, color: "#d16605"}];
			var LiveGraph=$("#LiveGraphElem").plot(dataset,{yaxis:{min:-100,max:100}});
		</script>
	</head>

	<body bgcolor="#c3c3c3">
		<script>
			var DebugBox=document.getElementById("StatusBox");
			const LiveGraphMaxMemoryTime=20;//seconds
			var socket = io.connect();
			socket.on('connect',function(){
				PrintDebugConsole('Server connected');
			});
			socket.on('LoggerData', function (data) {
				LiveGraphUpdate(data);
				//socket.emit('Ack', "LoggerData OK");
			});
			socket.on('DebugMessage', function (data) {
				PrintDebugConsole(data);
			});
			socket.on('disconnect',function(){
				PrintDebugConsole('Server disconnected');
			});
			
			function PrintDebugConsole(data){
				while( (DebugBox.value.length>500) && (DebugBox.value.indexOf('\n')!=-1) )
					DebugBox.value=DebugBox.value.substring(DebugBox.value.indexOf('\n')+1);
				DebugBox.value+="\n> "+data;
			}
			
			function LiveGraphUpdate(x)
			{
				var data=JSON.parse(x);
				var now=new Date().getTime();
				//console.log(data);
				while( ((now-Xaxis[0][0])>(LiveGraphMaxMemoryTime*1000)) && (Xaxis.length>1) )
				{
					Xaxis.shift();
					Yaxis.shift();
					Zaxis.shift();
				}
				Xaxis.push([now,data.x]);
				Yaxis.push([now,data.y]);
				Zaxis.push([now,data.z]);
				$("#LiveGraphElem").plot(
					dataset,{
						yaxis:{min:-40,max:40},
						xaxis: {show:false},
						grid: {aboveData: false,backgroundColor: "#575757",color: "black"},
						legend:{position:"sw",backgroundColor: "#202020"}
					}
				);
				//console.log("refreshed");
				//document.getElementById("StatusBox").value=data.temp;
			}
		</script>
   
	</body>
</html>